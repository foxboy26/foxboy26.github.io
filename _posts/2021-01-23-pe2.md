---
layout: post
title:  "Project Euler P2 - Even Fibonacci numbers"
date:   2021-01-23 18:00:00
categories: project_euler
tags: brute-force, Fibonacci
---
Here we comes the second problem about the famous [Fibonacci numbers](https://en.wikipedia.org/wiki/Fibonacci_number):rabbit:. The [problem](https://projecteuler.net/problem=2) states:

> Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:
>
> 
> $$
> 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...
> $$
> 
>
> By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.

## Brute-force Approach

Fibonacci numbers are defined recursively as


$$
F_n =
\begin{cases}
1                 & \text{if $n=1, 2$} \\
F_{n-1} + F_{n-2} & \text{if $n>2$}
\end{cases}
$$


For example, the first few Fibonacci numbers are:


$$
1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, ...
$$


The easiest way is probably to compute the Fibonacci terms one by one, and sum up the even terms until we reach $$4\times 10^6$$. Since Fibonacci number grows expotenially (as we will see below), this algorithm is efficient enough. The following Python snippet does the job:

```python
a = 1
b = 1
c = a + b
s = 0
while c < 4000000:
    if c % 2 == 0:
        s += c
    a = b
    b = c
    c = a + b
print s
```

## A Mathematical Approach

I am a bit curious on if we can do better on this problem, by finding a closed form for this summation. There is a [well-known result][1] that the sum of the first $$n$$ Fibnoacci numbers can be expressed as $$F_{n+2} - 1$$. Maybe we can find something similar?

First we notice that all the even Fibonacci numbers lie on $$F_3$$, $${F_6}$$ , $$F_9$$, ... In other words, all $$F_{3n}$$ are even Fibonacci numbers. This result comes from a simple fact that odd+odd=even, and even+odd=odd. Now the problem becomes to find the closed form for:


$$
S_n=\sum_{i=1}^nF_{3i}
$$


Let's try to write down a few terms to see if we can find a pattern.

| $$F_n$$ | 1    | 1    | 2    | 3    | 5    | 8    | 13   | 21   | 34   | 55   | 89   | 144  | 233  | 377  | 610  |
| ------- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| $$S_n$$ |      |      | 2    |      |      | 10   |      |      | 44   |      |      | 188  |      |      | 798  |

If you look carefullly, you might notice that $$2S_n= F_{3n+2} - 1$$ holds for all these terms we check. Let's try to proof this!

The simplest way is probably by induction. Here I will show another approach. Notice that by definition $$F_{3n} = F_{3n} + F_{3n-1}$$. Adding a $$F_{3n}$$ to both side of this equation gives:


$$
2F_{3n} = F_{3n} + F_{3n-1} + F_{3n-2}
$$


This means the sum of the first $$n$$ even Fibonacci numbers can be expressed as the sum of the first $$3n$$ Fibonacci numbers, and we know how to compute that. So


$$
2S_n=\sum_{i=1}^nF_{3i} = \sum_{i=1}^n(F_{3i} + F_{3i-1} + F_{3i-2}) = \sum_{k=1}^{3n}F_k = F_{3n+2} - 1
$$


Now that we have obtained the closed form. How does that help sovling this problem? We need one more tool: a closed form expression for computing $$F_n$$ directly. It turns out to be related to the famous [golden ratio](https://en.wikipedia.org/wiki/Golden_ratio)


$$
F_n = \frac{1}{\sqrt{5}}(\phi^n - (1-\phi))^n , \text{where $\phi=(1+\sqrt{5})/2 \approx 1.618$ is the golden ratio.}
$$
 

Hmm... You might think how useful this is. Here comes the trick. Since $$(1-\phi) \approx -0.618 < 1$$, this $$(1-\phi)^n$$ term only contributes to the fractional part of the result, and it vanishes pretty quickly when $$n$$ becomes large. So we have $${F_n \approx \frac{1}{\sqrt{5}}\phi^n}$$ 

Fibonacci numbers are always natural numbers. When $$n$$ is even, the second term contributes negatively to the result, so we should round down the result. When $$n$$ is odd, we should round up. This gives a simpler way to compute $$F_n$$


$$
F_n =
\begin{cases}
\lfloor\phi^n / \sqrt{5}\rfloor    & \text{if $n$ is even}  \\
\lceil\phi^n / \sqrt{5}\rceil    & \text{if $n$ is odd}
\end{cases}
$$


Now we are ready. Plug in $$\frac{1}{\sqrt{5}}\phi^n < 4000000$$ , we found that the 11th even Fibonacci number, $$F_{33} = 3524578$$, to be the largest one that is smaller than 4,000,000. Finally, with the help of a calculator and the approximate fomula, we have


$$
S_{11} = (F_{33+2} - 1) / 2 = \fbox{4613732}
$$
 

[1]: https://en.wikipedia.org/wiki/Fibonacci_number#Combinatorial_identities

